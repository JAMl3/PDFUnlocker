import os
import PyPDF2
import PySimpleGUI as sg

# Define the PySimpleGUI layout
layout = [
    [sg.Text('Select a folder containing password-protected PDF files')],
    [sg.Input(key='-FOLDER-', enable_events=True, visible=False), sg.FolderBrowse('Browse')],
    [sg.Button('Unlock'), sg.Button('Cancel')]
]

# Create the PySimpleGUI window
window = sg.Window('PDF Unlocker', layout)

# Event loop
while True:
    event, values = window.read()

    if event == sg.WIN_CLOSED or event == 'Cancel':
        break

    if event == 'Unlock':
        folder_path = values['-FOLDER-']

        # Loop through each file in the folder
        for filename in os.listdir(folder_path):
            filepath = os.path.join(folder_path, filename)

            # Check if the file is a PDF
            if os.path.isfile(filepath) and filename.lower().endswith('.pdf'):
                # Open the password-protected PDF file
                pdf_file = open(filepath, 'rb')
                pdf_reader = PyPDF2.PdfFileReader(pdf_file)

                # Create a new PDF writer object
                pdf_writer = PyPDF2.PdfFileWriter()

                # Loop through each page of the PDF file
                for page_num in range(pdf_reader.numPages):
                    # Extract the page and add it to the new PDF writer
                    page_obj = pdf_reader.getPage(page_num)
                    pdf_writer.addPage(page_obj)

                # Save the new PDF file without any password or permission restrictions
                output_filename = os.path.splitext(filename)[0] + '_Unlocked.pdf'
                output_filepath = os.path.join(folder_path, output_filename)
                output_file = open(output_filepath, 'wb')
                pdf_writer.write(output_file)

                # Close the file objects
                pdf_file.close()
                output_file.close()

        sg.popup('PDF files have been unlocked and saved in the same folder', title='PDF Unlocker')

# Close the PySimpleGUI window
window.close()
